# ğŸ§  Hybrid Alphaâ€“Guardian Trading Architecture

> **Paper-Grade Documentation for AI Trading Competition**

---

## ğŸ“ System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI TRADING SYSTEM ARCHITECTURE                         â”‚
â”‚                                 (Fund-Grade)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Market Tick (MT5) â”‚  â† Real-time price feeds
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FEATURE EXTRACTOR               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ Price: OHLCV (H1, H4)         â”‚    â”‚
â”‚  â”‚ â€¢ Indicators: EMA20, EMA50, ATR â”‚    â”‚
â”‚  â”‚ â€¢ RSI, ADX, MACD                â”‚    â”‚
â”‚  â”‚ â€¢ Account: Equity, Margin       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ            ALPHA LAYER                    â”ƒ  â† "Proposal Engine"
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”ƒ
â”ƒ  â”‚    Rule-Based Strategy           â”‚     â”ƒ
â”ƒ  â”‚    â€¢ EMA20 > EMA50 â†’ BUY         â”‚     â”ƒ
â”ƒ  â”‚    â€¢ EMA20 < EMA50 â†’ SELL        â”‚     â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”ƒ
â”ƒ                â†“                          â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”ƒ
â”ƒ  â”‚    AI Alpha (XGBoost Imitation)  â”‚     â”ƒ
â”ƒ  â”‚    â€¢ models/xgb_imitation.pkl    â”‚     â”ƒ
â”ƒ  â”‚    â€¢ Output: BUY/SELL/HOLD       â”‚     â”ƒ
â”ƒ  â”‚    â€¢ Confidence: 0.0 - 1.0       â”‚     â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¿â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ CANDIDATE TRADE â”‚  (Only if Rule == AI)
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           RISK FILTERS                      â”‚
â”‚  â€¢ Max Positions Check                      â”‚
â”‚  â€¢ Risk per Trade (2%)                      â”‚
â”‚  â€¢ Spread / Slippage Guard                  â”‚
â”‚  â€¢ Daily Loss Soft Check                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    GUARDIAN LAYER                                     â”ƒ  â† "Governance Engine"
â”ƒ                                                                       â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚       RULE-BASED GUARDIAN (Hard Safety Net)                     â”‚  â”ƒ
â”ƒ  â”‚                                                                 â”‚  â”ƒ
â”ƒ  â”‚  Priority 120: DD_LIMIT     (DD >= 10%)   â†’ EMERGENCY_FREEZE    â”‚  â”ƒ
â”ƒ  â”‚  Priority 110: ERROR_DETECT (error=True)  â†’ FORCE_HOLD          â”‚  â”ƒ  â—€â”€â”€ VETO
â”ƒ  â”‚  Priority 100: MARGIN_CRIT  (ratio < 20%) â†’ FORCE_HOLD          â”‚  â”ƒ
â”ƒ  â”‚  Priority  90: SPAM_BLOCK   (blocks >= 3) â†’ FORCE_HOLD          â”‚  â”ƒ
â”ƒ  â”‚  Priority  80: MARGIN_LOW   (ratio < 50%) â†’ REDUCE_RISK         â”‚  â”ƒ
â”ƒ  â”‚  Priority  70: DD_WARNING   (DD > 8%)     â†’ REDUCE_RISK         â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”ƒ                                    â†“                                  â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚       PPO GUARDIAN (Advisor Mode)                               â”‚  â”ƒ
â”ƒ  â”‚                                                                 â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Model: models/guardian_ppo.zip                               â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Actions: ALLOW / REDUCE_RISK / FORCE_HOLD / EMERGENCY_FREEZE â”‚  â”ƒ  â—€â”€â”€ SUGGEST
â”ƒ  â”‚  â€¢ Confidence Threshold: 0.65                                   â”‚  â”ƒ
â”ƒ  â”‚  â€¢ Training: PPO with 6-dim observation                         â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”ƒ                                    â†“                                  â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ  â”‚       HYBRID ARBITRATION                                        â”‚  â”ƒ
â”ƒ  â”‚                                                                 â”‚  â”ƒ
â”ƒ  â”‚  IF rule_guardian == BLOCK:                                     â”‚  â”ƒ
â”ƒ  â”‚      â†’ BLOCK (Rule has absolute veto)                           â”‚  â”ƒ
â”ƒ  â”‚  ELIF ppo_action == FREEZE AND confidence > 0.9:                â”‚  â”ƒ
â”ƒ  â”‚      â†’ BLOCK (High-confidence PPO override)                     â”‚  â”ƒ
â”ƒ  â”‚  ELSE:                                                          â”‚  â”ƒ
â”ƒ  â”‚      â†’ ALLOW                                                    â”‚  â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¿â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                     â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ ORDER ALLOWED? â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â†“                     â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   YES   â”‚           â”‚   NO    â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ORDER EXECUTION            â”‚   â”‚  SHADOW RECORD  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  (For Analysis) â”‚
â”‚  â”‚ â€¢ Calculate Lot (RiskManager)â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ â€¢ AI SL/TP Prediction        â”‚  â”‚
â”‚  â”‚ â€¢ Send to MT5                â”‚  â”‚
â”‚  â”‚ â€¢ Trailing SL Management     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ Key Design Principles

| Principle | Implementation |
|-----------|---------------|
| **Alpha proposes, Guardian disposes** | Alpha generates trade signals; Guardian controls execution rights |
| **Rule-based has absolute veto** | Safety rules cannot be bypassed by AI |
| **PPO is advisory only** | PPO suggestions are soft; require high confidence to override |
| **Daily DD Latch** | Once DD limit hit, all trading blocked until next day |
| **Escalation protocol** | 3+ blocks â†’ 5-minute FORCE_HOLD cooldown |

---

## ğŸ“Š Component Summary

| Layer | Role | Decision Type |
|-------|------|---------------|
| **Alpha (Rule)** | EMA crossover strategy | Directional Signal |
| **Alpha (AI)** | XGBoost imitation model | Confirmation |
| **Guardian (Rule)** | Hard safety checks | BLOCK / ALLOW |
| **Guardian (PPO)** | Learned risk patterns | SUGGEST |
| **Guardian (Hybrid)** | Arbitrate Rule + PPO | FINAL DECISION |

---

## ğŸ† Paper Statement

> *"Our system separates intelligence from governance: Alpha agents focus solely on opportunity generation, while a hierarchical Guardian enforces capital preservation, enabling safe reinforcement learning in live financial markets."*

---

## ğŸ“ Related Files

| File | Purpose |
|------|---------|
| [live_loop_v3.py](file:///f:/Mobile%20App/AI%20trade%20à¹à¸‚à¸‡à¸‚à¸±à¸™/live_loop_v3.py) | Main trading loop |
| [guardian_margin_gate.py](file:///f:/Mobile%20App/AI%20trade%20à¹à¸‚à¸‡à¸‚à¸±à¸™/src/safety/guardian_margin_gate.py) | Hard margin protection |
| [guardian_agent.py](file:///f:/Mobile%20App/AI%20trade%20à¹à¸‚à¸‡à¸‚à¸±à¸™/src/rl/guardian_agent.py) | Rule-based Guardian |
| [guardian_ppo_infer.py](file:///f:/Mobile%20App/AI%20trade%20à¹à¸‚à¸‡à¸‚à¸±à¸™/src/rl/guardian_ppo_infer.py) | PPO Guardian advisor |
| [guardian_hybrid.py](file:///f:/Mobile%20App/AI%20trade%20à¹à¸‚à¸‡à¸‚à¸±à¸™/src/guardian/guardian_hybrid.py) | Hybrid arbitration |
